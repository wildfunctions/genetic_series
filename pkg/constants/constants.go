package constants

import "math/big"

// DefaultPrecision is the default precision in bits (~154 decimal digits).
const DefaultPrecision = 512

// Constant represents a named mathematical constant with a high-precision value.
type Constant struct {
	Name         string
	Value        *big.Float
	Float64Value float64
}

var registry = map[string]Constant{}

func init() {
	// Euler-Mascheroni gamma
	register("euler_gamma",
		"0.5772156649015328606065120900824024310421"+
			"5933593992359880576723488486772677766467"+
			"0936947063291746749514631447249807082480"+
			"9600265022796782354781636009341721641219"+
			"9245863150302861829745557067498385054945"+
			"8858692699569092721079750930295532116534")

	// pi
	register("pi",
		"3.1415926535897932384626433832795028841971"+
			"6939937510582097494459230781640628620899"+
			"8628034825342117067982148086513282306647"+
			"0938446095505822317253594081284811174502"+
			"8410270193852110555964462294895493038196"+
			"4428810975665933446128475648233786783165")

	// e (Euler's number)
	register("e",
		"2.7182818284590452353602874713526624977572"+
			"4709369995957496696762772407663035354759"+
			"4571382178525166427427466391932003059921"+
			"8174135966290435729003342952605956307381"+
			"3232862794349076323382988075319525101901"+
			"1573834187930702154089149934884167509244")

	// natural log of 2
	register("ln2",
		"0.6931471805599453094172321214581765680755"+
			"0013436025525412068000949339362196969471"+
			"5605863326996418687542001481020570685733"+
			"6855202357581305570326707516350759619307"+
			"2757082837143519030703862389167347112335"+
			"0115364497955239120475174897943149409978")

	// Catalan's constant
	register("catalan",
		"0.9159655941772190150546035149323841107741"+
			"4937428167213426649811962176301977625476"+
			"9479356512926115106248574422619196199579"+
			"0358988033258590594315947374811584069953"+
			"3202877331946051903872747816408786590902"+
			"4706484152163000228727640942388259957741")

	// Apery's constant (zeta(3))
	register("apery",
		"1.2020569031595942853997381615114499907649"+
			"8629234049888179227155534183820578631309"+
			"0186455873609335258146199157795260719418"+
			"4925066265788304366421542293787082365828"+
			"1175663006524234158764758002549537812485"+
			"0654059421297375648142983530828308522096")
}

func register(name, value string) {
	f, _, err := big.ParseFloat(value, 10, DefaultPrecision, big.ToNearestEven)
	if err != nil {
		panic("bad constant " + name + ": " + err.Error())
	}
	f64, _ := f.Float64()
	registry[name] = Constant{Name: name, Value: f, Float64Value: f64}
}

// Get returns the constant with the given name, or nil if not found.
func Get(name string) *Constant {
	c, ok := registry[name]
	if !ok {
		return nil
	}
	return &c
}

// Names returns all registered constant names.
func Names() []string {
	names := make([]string, 0, len(registry))
	for k := range registry {
		names = append(names, k)
	}
	return names
}
